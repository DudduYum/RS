<html>
	<head>
		<title>Project OLA</title>

		<!-- style -->
		<link rel="stylesheet" type="text/css" href="style/baseStyle.css">
		<link rel="stylesheet" type="text/css" href="style/initialScreen.css">
		<link rel="stylesheet" type="text/css" href="style/gameoverScreen.css">
		<link rel="stylesheet" type="text/css" href="style/switch.css">

		<!--  Libraris-->
		<script type="text/javascript" src="lib/three.min.js"></script>
		<script type="text/javascript" src="lib/requirejs_2.2.js"></script>
		<script type="text/javascript" src="lib/OrbitControls.js"></script>
		<script type="text/javascript" src="lib/stats.min.js"></script>
		<script src="lib/EffectComposer.js"></script>
		<script src="lib/CopyShader.js"></script>
		<script src="lib/ShaderPass.js"></script>
		<script src="lib/RenderPass.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

		<!--  Our scripts and class-->
		<script type="text/javascript" src="js/IO_Manager.js"></script><!-- V -->
		<script type="text/javascript" src="js/game_score_counter.js"></script><!-- V -->
		<script type="text/javascript" src="js/game_state_controller.js"></script><!-- V -->
		<script type="text/javascript" src="js/game_settings_object.js"></script><!-- V -->
		<script type="text/javascript" src="js/environment_builder.js"></script><!-- V -->
		<script type="text/javascript" src="js/asteroid_class.js"></script> <!-- V -->
		<script type="text/javascript" src="js/spaceship_class.js"></script><!-- V -->
		<script type="text/javascript" src="js/game_Materials.js"></script>
		<script type="text/javascript" src="js/timer.js"></script><!-- V -->
		<script type="text/javascript" src="js/interfaceControl.js"></script><!-- V -->
		<script type="text/javascript" src="js/main.js"></script><!-- V -->
		<script type="text/javascript" src="shaders/postprocessing.js"></script><!-- V -->


		<script type="text/ogsl" id="asteroidVS">
			// point propertys
			varying vec3 tNorm;
			varying vec2 vUv;
			varying vec3 pointPosition;

			varying vec3 lightVector;

			uniform sampler2D displaysmentMap;

			uniform vec3 pointLightPos;

			void main() {

					vUv = uv;

					tNorm = normalMatrix * normal;

					// get texture coordinates
					vec4 distortion = texture2D( displaysmentMap , uv);

					//change the normal
					vec3 newNormal = (tNorm * distortion.x) ;

					// actually make displaysment
					vec3 nPosition = position + newNormal * 0.9;

					pointPosition = (modelViewMatrix * vec4( nPosition, 1.0 )).xyz;

					vec4 lPosition = viewMatrix * vec4( pointLightPos, 1.0 );
					lightVector = lPosition.xyz - pointPosition;

					gl_Position = projectionMatrix * vec4( pointPosition , 1.) ;


			}
		</script>

		<script type="text/ogsl" id="asteroidFS">
			// fragment propertys
			varying vec3 tNorm;
			varying vec3 pointPosition;

			//texture coordinates
			varying vec2 vUv;


			varying vec3 lightVector;

			// lights
			uniform vec3 lightPower;
			// uniform vec3 c_spec;
			uniform vec3 c_diff;
			uniform float alpha;

			uniform float s;

			// maps & texture
			uniform sampler2D tex;
			uniform sampler2D normMap;



			// start ininitializzation
			#define PI 3.14159265
			// #extension GL_OES_standard_derivatives : enable

			// vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {
			// 	vec3 q0 = dFdx( eye_pos.xyz );
			// 	vec3 q1 = dFdy( eye_pos.xyz );
			//
			// 	vec2 st0 = dFdx( uVv.st );
			// 	vec2 st1 = dFdy( uVv.st );
			//
			// 	vec3 S = normalize( q0 * st1.t - q1 * st0.t );
			// 	vec3 T = normalize( -q0 * st1.s + q1 * st0.s );
			// 	vec3 N = normalize( surf_norm );
			//
			// 	vec3 mapN = texture2D( normalMap, uVv ).xyz * 2.0 - 1.0;
			// 	mapN.xy = normalScale * mapN.xy;
			// 	mat3 tsn = mat3( S, T, N );
			//
			// 	return normalize( tsn * mapN );
			// }


			float G(float LdotH) {
				return 1.0/pow(LdotH,2.0);
			}

			vec3 F(float LdotH ) {
				vec3 c_spec = (texture2D(tex,vUv)).rgb;
				return c_spec + (vec3(1.0) - c_spec) * pow( 1.0 - LdotH , 5.0);
			}



			float D(float NdotH) {
				float A = pow(alpha,2.0);
				float B = PI * pow(pow(NdotH,2.0)*(A-1.0) + 1.0, 2.0);
				return A/B;
			}

			void main(){

				// vec3 color = (texture2D(tex,vUv)).xyz;

				vec3 n = normalize( tNorm );
				vec3 v = normalize( -pointPosition );
				vec3 l = normalize( lightVector );
				vec3 h = normalize( v + l );

				float NdotH = max(0.000001, dot( n, h ));
				float VdotH = max(0.000001, dot( v, h ));
				float NdotV = max(0.000001, dot( n, v ));
				float NdotL = max(0.000001, dot( n, l ));

				// test


				vec3 Specular = F(VdotH  ) * G(VdotH) * D(NdotH) / 4.0;


				vec3 beta = lightPower / (4.0 * PI * pow( length(lightVector) , 2.0));



				gl_FragColor = vec4(beta + Specular , 1.0);

				// gl_FragColor = texture2D(tex,vUv);

			}
		</script>

	</head>


	<body>


		<script type="text/javascript" >
			var switchToFreeCamera = function (){
				// just a global function that will be changed late
			};

			var switchToGameCamera = function (){
				// just a global function that will be changed late

			};

		</script>




		<div id="canvas"></div>

		<div id="scoreTable">
			<h1 id="currentScore">0</h1>
		</div>

		<div id="initialScreen">
			<div id="gameTitle">
				<h1>OH LOOK, AN ASTEROID...</h1><br/>
				<h3>Damn, asteroid storm incoming!</h3><br/>
			</div>
			<div id="instructions">
				<p>- press [SPACEBAR] to start the game</p><br/>
				<p>- use arrows or W,A,S,D to move your spaceship and avoid asteroids</p><br/>
				<p>- press [SPACEBAR] during game to stop spaceship movement
				<p>- click the button or press C to switch camera</p><br/>

				<p>Good luck!</p>
			</div>
		</div>


		<div id="gameoverScreen">
			<div id="score">
				<h1 id="yourScore"></h1><br/>
				<h3>Not bad!</h3><br/>
			</div>
			<div id="goInstructions">
				<p>Press [SPACEBAR] to play again!</p><br/>
			</div>

		</div>

		<div id="cameraSwitch">
			<div id="switchContainer">
				<button id="freeCameraButton" onclick="switchToFreeCamera()" type="button">FREE camera</button>
				<button id="gameCameraButton" onclick="switchToGameCamera()" type="button">GAME camera</button>
			</div>
		</div>

		<div id="authors">
			<p >Developed by Riccardo Lulli, Rostyslav Kostyuk</p>
		</div>


		<!--  game evocation -->
		<script type="text/javascript" >





		main();




		</script>

	</body>
</html>
